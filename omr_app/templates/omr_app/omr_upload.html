{% extends 'base.html' %} {% block content %}
<div class="row justify-content-center">
  <div class="col-md-8">
    <div class="card">
      <div class="card-header">
        <h3 class="card-title">OMR 답안지 업로드</h3>
      </div>
      <div class="card-body">
        <form id="omrForm" enctype="multipart/form-data">
          <div class="mb-3">
            <label for="image" class="form-label">OMR 답안지 이미지</label>
            <input
              type="file"
              class="form-control"
              id="image"
              name="image"
              accept="image/*,.pdf"
              required
            />
          </div>
          <button type="submit" class="btn btn-primary">처리하기</button>
        </form>
        <div id="result" class="mt-3"></div>
      </div>
    </div>
  </div>
</div>

<script>
  document.getElementById("omrForm").addEventListener("submit", async (e) => {
    e.preventDefault();
    const formData = new FormData(e.target);
    const resultDiv = document.getElementById("result");

    try {
      const response = await fetch('{% url "omr_app:omr_process" %}', {
        method: "POST",
        body: formData,
      });

      const data = await response.json();

      if (data.status === "success") {
        resultDiv.innerHTML = `
                <div class="alert alert-success">
                    처리 완료!<br>
                    학생: ${data.data.student_name} (${data.data.student_id})<br>
                    시험일: ${data.data.exam_date}<br>
                    반: ${data.data.class_code}
                    <br><br>
                    <a href="/omr/results/${data.data.id}" class="btn btn-info">상세 결과 보기</a>
                </div>
            `;
      } else {
        resultDiv.innerHTML = `<div class="alert alert-danger">오류: ${data.message}</div>`;
      }
    } catch (error) {
      resultDiv.innerHTML =
        '<div class="alert alert-danger">서버 오류가 발생했습니다.</div>';
    }
  });
</script>
{% endblock %}
